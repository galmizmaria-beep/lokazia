<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ò–≥—Ä</title>
    <style>
        /* --- –û–ë–©–ò–ï –°–¢–ò–õ–ò --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1, h2, h3 { color: #1e3a8a; }
        button {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #1d4ed8; }
        button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        /* --- –°–¢–ò–õ–ò –†–ï–î–ê–ö–¢–û–†–ê --- */
        #editor-container .section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        #editor-container .question-block {
            background: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
        }
        .option-group { display: flex; align-items: center; margin-bottom: 8px; }
        .option-group input[type="radio"] { width: auto; margin-right: 10px; margin-top: 0; }
        #generated-code-area { display: none; margin-top: 20px; }
        #iframe-code {
            width: 100%;
            min-height: 100px;
            background: #111827;
            color: #a5f3fc;
            font-family: monospace;
            padding: 10px;
            border-radius: 6px;
        }
        .remove-btn { background-color: #dc2626; }
        .remove-btn:hover { background-color: #b91c1c; }


        /* --- –°–¢–ò–õ–ò –ò–ì–†–´ --- */
        #game-container { text-align: center; }
        #start-screen .char-selector, #start-screen .level-selector { margin: 20px 0; }
        #start-screen img {
            width: 100px;
            height: 100px;
            border: 3px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            object-fit: cover;
            margin: 5px;
        }
        #start-screen img.selected {
            border-color: #2563eb;
            transform: scale(1.1);
        }
        .level-btn.selected { background-color: #1d4ed8; }
        
        #hud { display: flex; justify-content: space-around; align-items: center; margin-bottom: 20px; font-size: 1.2em; font-weight: bold; flex-wrap: wrap; gap: 10px;}
        #hud .hud-item { background: #eef2ff; padding: 10px 20px; border-radius: 8px; }
        #hud .lives::after { content: ' ‚ù§Ô∏è'; }

        #game-board {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            perspective: 1000px;
        }
        .card {
            width: 100%;
            aspect-ratio: 3/4;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .card.flipped { transform: rotateY(180deg); }
        .card.solved { cursor: default; opacity: 0.6; transform: rotateY(180deg) scale(0.95); }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 2em;
            overflow: hidden;
            text-align: center;
        }
        .card-front { background: #60a5fa; color: white; }
        .card-back { background: #f0f9ff; transform: rotateY(180deg); padding: 5px; }
        .card-back.correct-anim { animation: correct-pulse 0.5s; }
        @keyframes correct-pulse { 0% { background-color: #a7f3d0; } 100% { background-color: #f0f9ff; } }
        
        #question-modal {
            position: fixed;
            z-index: 1000;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: all 0.3s;
        }
        #question-modal.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            text-align: left;
        }
        .modal-content .answers button {
            display: block; width: 100%; margin-top: 10px; text-align: left; background-color: #f1f5f9; color: #333;
        }
        .modal-content .answers button:hover:not(:disabled) { background-color: #e2e8f0; }
        .modal-content .answers button.correct { background-color: #4ade80 !important; color: white; }
        .modal-content .answers button.incorrect { background-color: #f87171 !important; color: white; }
        
        #end-screen h2 { font-size: 2.5em; }
        #end-screen p { font-size: 1.5em; }
        
        /* –°–∫—Ä—ã—Ç–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö –±–ª–æ–∫–æ–≤ */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">
        <!-- ======================= –†–ï–î–ê–ö–¢–û–† (–≤–∏–¥–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ======================= -->
        <div id="editor-container">
            <h1>üìù –†–µ–¥–∞–∫—Ç–æ—Ä –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ò–≥—Ä—ã</h1>
            <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∏–≥—Ä—É —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ iframe –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ Genially –∏–ª–∏ –Ω–∞ —Å–∞–π—Ç.</p>

            <div class="section">
                <h2>1. –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <label for="game-title">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã:</label>
                <input type="text" id="game-title" value="–ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è!">
            </div>

            <div class="section">
                <h2>2. –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h2>
                <p>–î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π. –£—á–µ–Ω–∏–∫ —Å–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–∏—Ö.</p>
                <div id="characters-container">
                    <input type="text" class="character-input" placeholder="https://..." value="https://placehold.co/100x100/3B82F6/FFFFFF/png?text=–†–æ–±–æ—Ç">
                    <input type="text" class="character-input" placeholder="https://..." value="https://placehold.co/100x100/F97316/FFFFFF/png?text=–õ–∏—Å–∞">
                </div>
                 <button id="add-character-btn">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
            </div>

            <div class="section">
                <h2>3. –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –≥–µ–π–º–ø–ª–µ–π</h2>
                <label for="lives-easy">–ö–æ–ª-–≤–æ –∂–∏–∑–Ω–µ–π (–ª–µ–≥–∫–∏–π —É—Ä–æ–≤–µ–Ω—å):</label>
                <input type="number" id="lives-easy" value="5" min="1">
                <label for="lives-hard">–ö–æ–ª-–≤–æ –∂–∏–∑–Ω–µ–π (—Å–ª–æ–∂–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å):</label>
                <input type="number" id="lives-hard" value="3" min="1">
                <label for="time-hard">–í—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (—Å–ª–æ–∂–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å, 0 - –±–µ–∑ —Ç–∞–π–º–µ—Ä–∞):</label>
                <input type="number" id="time-hard" value="180" min="0">
            </div>

            <div class="section">
                <h2>4. –ó–∞–¥–∞–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö</h2>
                <div id="questions-container">
                    <!-- –ë–ª–æ–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ JS-–æ–º -->
                </div>
                <button id="add-question-btn">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
            </div>

            <button id="generate-code-btn">üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–≥—Ä—ã</button>

            <div id="generated-code-area">
                <h3>–ì–æ—Ç–æ–≤–æ!</h3>
                <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –∫–∞–∫ iframe –≤ Genially:</p>
                <textarea id="iframe-code" readonly onclick="this.select()"></textarea>
            </div>
        </div>

        <!-- ======================= –ò–ì–†–ê (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ======================= -->
        <div id="game-container" class="hidden">
            <h1 id="game-title-display"></h1>

            <!-- –≠–∫—Ä–∞–Ω 1: –°—Ç–∞—Ä—Ç -->
            <div id="start-screen">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</h2>
                <div id="character-selector" class="char-selector"></div>
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å:</h2>
                <div class="level-selector">
                    <button class="level-btn" data-level="easy">–õ–µ–≥–∫–∏–π</button>
                    <button class="level-btn" data-level="hard">–°–ª–æ–∂–Ω—ã–π</button>
                </div>
                <button id="start-game-btn" disabled>–ù–∞—á–∞—Ç—å –∏–≥—Ä—É!</button>
            </div>

            <!-- –≠–∫—Ä–∞–Ω 2: –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å -->
            <div id="game-process" class="hidden">
                <div id="hud">
                    <div id="player-char"></div>
                    <div id="score" class="hud-item">–û—á–∫–∏: 0</div>
                    <div id="lives" class="hud-item lives">5</div>
                    <div id="timer" class="hud-item"></div>
                </div>
                <div id="game-board"></div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω 3: –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã -->
            <div id="end-screen" class="hidden">
                <h2 id="end-title">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
                <p id="end-message"></p>
                <button onclick="window.location.reload()">–°—ã–≥—Ä–∞—Ç—å –µ—â–µ —Ä–∞–∑</button>
            </div>
        </div>

    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤–æ–ø—Ä–æ—Å–æ–º -->
    <div id="question-modal">
        <div class="modal-content">
            <h3 id="question-text"></h3>
            <div id="question-answers" class="answers"></div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ======================= –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ =======================
        const editorContainer = document.getElementById('editor-container');
        const gameContainer = document.getElementById('game-container');
        let gameConfig = {}; // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
        let gameState = { // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            score: 0,
            lives: 3,
            level: '',
            character: '',
            timerId: null,
            timeLeft: 0,
            solvedCards: 0
        };

        // ======================= –õ–û–ì–ò–ö–ê –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –†–ï–ñ–ò–ú–ê (–†–ï–î–ê–ö–¢–û–†/–ò–ì–†–ê) =======================
        const urlParams = new URLSearchParams(window.location.search);
        const configData = urlParams.get('config');

        if (configData) {
            // –†–ï–ñ–ò–ú –ò–ì–†–´: –µ—Å–ª–∏ –≤ URL –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä 'config', –∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
            try {
                const decodedConfig = decodeURIComponent(atob(configData));
                gameConfig = JSON.parse(decodedConfig);
                editorContainer.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                initGame();
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–≥—Ä—ã:", e);
                editorContainer.innerHTML = "<h1>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã. –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</h1>";
            }
        } else {
            // –†–ï–ñ–ò–ú –†–ï–î–ê–ö–¢–û–†–ê: –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
            initEditor();
        }

        // ======================= –õ–û–ì–ò–ö–ê –†–ï–î–ê–ö–¢–û–†–ê =======================
        function initEditor() {
            document.getElementById('add-character-btn').addEventListener('click', addCharacterInput);
            document.getElementById('add-question-btn').addEventListener('click', addQuestionBlock);
            document.getElementById('generate-code-btn').addEventListener('click', generateCode);
            addQuestionBlock(); // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }
        
        function addCharacterInput() {
            const container = document.getElementById('characters-container');
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'character-input';
            input.placeholder = 'https://...';
            container.appendChild(input);
        }

        function addQuestionBlock() {
            const container = document.getElementById('questions-container');
            const questionIndex = container.children.length;
            const questionBlock = document.createElement('div');
            questionBlock.className = 'question-block';
            questionBlock.innerHTML = `
                <h4>–í–æ–ø—Ä–æ—Å ${questionIndex + 1}</h4>
                <textarea class="question-text" placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞..."></textarea>
                <div class="options-container">
                    <div class="option-group">
                        <input type="radio" name="correct_q${questionIndex}" value="0" checked>
                        <input type="text" class="option-text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 1 (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)">
                    </div>
                    <div class="option-group">
                        <input type="radio" name="correct_q${questionIndex}" value="1">
                        <input type="text" class="option-text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 2">
                    </div>
                </div>
                <button type="button" class="add-option-btn" style="margin-right: 10px;">–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
                <button type="button" class="remove-question-btn remove-btn">–£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
            `;
            container.appendChild(questionBlock);

            questionBlock.querySelector('.add-option-btn').addEventListener('click', () => addOption(questionBlock, questionIndex));
            questionBlock.querySelector('.remove-question-btn').addEventListener('click', () => {
                questionBlock.remove();
                // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏
                document.querySelectorAll('#questions-container h4').forEach((h4, i) => h4.textContent = `–í–æ–ø—Ä–æ—Å ${i + 1}`);
            });
        }

        function addOption(questionBlock, questionIndex) {
            const optionsContainer = questionBlock.querySelector('.options-container');
            const optionIndex = optionsContainer.children.length;
            const optionGroup = document.createElement('div');
            optionGroup.className = 'option-group';
            optionGroup.innerHTML = `
                <input type="radio" name="correct_q${questionIndex}" value="${optionIndex}">
                <input type="text" class="option-text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ ${optionIndex + 1}">
            `;
            optionsContainer.appendChild(optionGroup);
        }

        function generateCode() {
            const config = {
                title: document.getElementById('game-title').value,
                characters: Array.from(document.querySelectorAll('.character-input')).map(input => input.value).filter(Boolean),
                levels: {
                    easy: { lives: parseInt(document.getElementById('lives-easy').value) },
                    hard: { lives: parseInt(document.getElementById('lives-hard').value), time: parseInt(document.getElementById('time-hard').value) }
                },
                questions: []
            };

            document.querySelectorAll('.question-block').forEach((block, index) => {
                const questionText = block.querySelector('.question-text').value;
                const options = Array.from(block.querySelectorAll('.option-text')).map(input => input.value);
                const correctOptionInput = block.querySelector(`input[name="correct_q${index}"]:checked`);
                
                if (questionText && options.length > 1 && options.every(Boolean) && correctOptionInput) {
                     const correctOptionIndex = parseInt(correctOptionInput.value);
                    config.questions.push({
                        question: questionText,
                        options: options,
                        answer: correctOptionIndex
                    });
                }
            });

            if (config.questions.length === 0) {
                alert("–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å (—Å —Ç–µ–∫—Å—Ç–æ–º –∏ –º–∏–Ω–∏–º—É–º –¥–≤—É–º—è –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–∞)!");
                return;
            }
            if (config.characters.length === 0) {
                alert("–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!");
                return;
            }

            const jsonConfig = JSON.stringify(config);
            const base64Config = btoa(encodeURIComponent(jsonConfig));
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º location.origin + location.pathname —á—Ç–æ–±—ã —Å—Å—ã–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ –∏ –ª–æ–∫–∞–ª—å–Ω–æ, –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            const gameUrl = `${window.location.origin}${window.location.pathname}?config=${base64Config}`;
            const iframeHtml = `<iframe src="${gameUrl}" width="800" height="600" frameborder="0" allowfullscreen></iframe>`;
            
            document.getElementById('iframe-code').value = iframeHtml;
            document.getElementById('generated-code-area').style.display = 'block';
        }

        // ======================= –õ–û–ì–ò–ö–ê –ò–ì–†–´ =======================
        function initGame() {
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
            document.getElementById('game-title-display').textContent = gameConfig.title;
            const charSelector = document.getElementById('character-selector');
            gameConfig.characters.forEach(charUrl => {
                const img = document.createElement('img');
                img.src = charUrl;
                img.alt = "–ü–µ—Ä—Å–æ–Ω–∞–∂";
                img.onclick = () => selectCharacter(img);
                charSelector.appendChild(img);
            });
            
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.onclick = () => selectLevel(btn);
            });

            document.getElementById('start-game-btn').onclick = startGame;
        }

        function selectCharacter(selectedImg) {
            document.querySelectorAll('#character-selector img').forEach(img => img.classList.remove('selected'));
            selectedImg.classList.add('selected');
            gameState.character = selectedImg.src;
            checkStartButton();
        }

        function selectLevel(selectedBtn) {
            document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('selected'));
            selectedBtn.classList.add('selected');
            gameState.level = selectedBtn.dataset.level;
            checkStartButton();
        }
        
        function checkStartButton() {
            if (gameState.character && gameState.level) {
                document.getElementById('start-game-btn').disabled = false;
            }
        }

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-process').classList.remove('hidden');

            const levelSettings = gameConfig.levels[gameState.level];
            gameState.lives = levelSettings.lives;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HUD (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
            document.getElementById('player-char').innerHTML = `<img src="${gameState.character}" style="width:50px; height:50px; border-radius:50%; object-fit:cover;" alt="–ê–≤–∞—Ç–∞—Ä –∏–≥—Ä–æ–∫–∞">`;
            updateHUD();

            // –¢–∞–π–º–µ—Ä
            const timerEl = document.getElementById('timer');
            if (gameState.level === 'hard' && levelSettings.time > 0) {
                gameState.timeLeft = levelSettings.time;
                timerEl.style.display = 'block';
                updateTimer(); // –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤, —á—Ç–æ–±—ã –Ω–µ –∂–¥–∞—Ç—å —Å–µ–∫—É–Ω–¥—É
                gameState.timerId = setInterval(updateTimer, 1000);
            } else {
                timerEl.style.display = 'none';
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∞ –∏–≥—Ä–æ–≤–æ–º –ø–æ–ª–µ
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            gameConfig.questions.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.questionIndex = index;
                card.innerHTML = `
                    <div class="card-face card-front">${index + 1}</div>
                    <div class="card-face card-back"></div>
                `;
                card.addEventListener('click', () => flipCard(card));
                board.appendChild(card);
            });
        }
        
        function updateHUD() {
            document.getElementById('score').textContent = `–û—á–∫–∏: ${gameState.score}`;
            document.getElementById('lives').textContent = gameState.lives;
        }
        
        function updateTimer() {
            const timerEl = document.getElementById('timer');
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            timerEl.textContent = `–í—Ä–µ–º—è: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            if (gameState.timeLeft <= 0) {
                endGame(false, "–í—Ä–µ–º—è –≤—ã—à–ª–æ!");
            }
            gameState.timeLeft--;
        }

        function flipCard(card) {
            if (card.classList.contains('flipped') || card.classList.contains('solved')) return;
            card.classList.add('flipped');
            setTimeout(() => showQuestion(card), 400); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        }

        function showQuestion(card) {
            const qIndex = card.dataset.questionIndex;
            const questionData = gameConfig.questions[qIndex];
            
            document.getElementById('question-text').textContent = questionData.question;
            const answersContainer = document.getElementById('question-answers');
            answersContainer.innerHTML = '';
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
            const shuffledOptions = questionData.options
                .map((value, index) => ({ value, originalIndex: index }))
                .sort(() => Math.random() - 0.5);

            shuffledOptions.forEach(({value, originalIndex}) => {
                const button = document.createElement('button');
                button.textContent = value;
                button.onclick = () => checkAnswer(originalIndex, questionData.answer, button, card);
                answersContainer.appendChild(button);
            });
            
            document.getElementById('question-modal').classList.add('visible');
        }

        function checkAnswer(selectedIndex, correctIndex, button, card) {
            document.querySelectorAll('#question-answers button').forEach(btn => btn.disabled = true);
            const isCorrect = selectedIndex === correctIndex;

            if (isCorrect) {
                button.classList.add('correct');
                gameState.score += 10;
                gameState.solvedCards++;
                card.classList.add('solved');
                card.querySelector('.card-back').innerHTML = '‚úÖ';
                card.querySelector('.card-back').classList.add('correct-anim');
            } else {
                button.classList.add('incorrect');
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                const allButtons = Array.from(document.querySelectorAll('#question-answers button'));
                const correctButton = allButtons.find(b => b.textContent === gameConfig.questions[card.dataset.questionIndex].options[correctIndex]);
                if(correctButton) correctButton.classList.add('correct');

                gameState.lives--;
                setTimeout(() => card.classList.remove('flipped'), 1000); // –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
            }
            
            updateHUD();
            
            setTimeout(() => {
                document.getElementById('question-modal').classList.remove('visible');
                if (gameState.lives <= 0) {
                    endGame(false, "–ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –ø–æ–ø—ã—Ç–∫–∏!");
                } else if (gameState.solvedCards === gameConfig.questions.length) {
                    endGame(true, "–í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã!");
                }
            }, 1500);
        }

        function endGame(isWin, message) {
            clearInterval(gameState.timerId);
            document.getElementById('game-process').classList.add('hidden');
            const endScreen = document.getElementById('end-screen');
            endScreen.classList.remove('hidden');

            const endTitle = document.getElementById('end-title');
            const endMessage = document.getElementById('end-message');

            if (isWin) {
                endTitle.textContent = "üéâ –ü–æ–±–µ–¥–∞! üéâ";
            } else {
                endTitle.textContent = "ü§î –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!";
            }
            endMessage.innerHTML = `${message}<br>–í–∞—à —Å—á–µ—Ç: ${gameState.score}`;
        }
    });
    </script>
</body>
</html>
