<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ö–≤–µ—Å—Ç–æ–≤ 3.0</title>
    <style>
        :root {
            --bg-color: #f4f7f9; --panel-bg: #ffffff; --border-color: #e0e6ed;
            --text-color: #333; --primary-color: #4a90e2; --primary-hover: #357abd;
            --danger-color: #d9534f; --success-color: #5cb85c; --font-family: 'Segoe UI', Roboto, sans-serif;
        }
        body { font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-color); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .container { display: flex; width: 100%; height: 100%; }
        #editor-panel { width: 45%; padding: 20px; background-color: var(--panel-bg); border-right: 1px solid var(--border-color); overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.05); }
        h1, h2 { color: var(--primary-color); }
        h1 { margin-top: 0; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }
        details { background-color: #fafafa; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 15px; padding: 10px; transition: all 0.2s ease-in-out; }
        details[open] { background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        summary { font-weight: bold; font-size: 1.2em; cursor: pointer; list-style: none; padding: 5px; }
        summary::before { content: '‚ñ∂ '; display: inline-block; transition: transform 0.2s; }
        details[open] summary::before { transform: rotate(90deg); }
        .form-group, .task-item { margin: 15px 0; border: 1px dashed var(--border-color); padding: 15px; border-radius: 8px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input[type="text"], textarea, select { width: calc(100% - 22px); padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 1em; }
        textarea { resize: vertical; min-height: 100px; } /* –£–≤–µ–ª–∏—á–∏–ª –≤—ã—Å–æ—Ç—É –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ */
        .btn { background-color: var(--primary-color); color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-size: 1em; transition: background-color 0.2s; }
        .btn:hover { background-color: var(--primary-hover); }
        .btn-add { margin-top: 10px; }
        .btn-delete { background-color: var(--danger-color); font-size: 0.8em; padding: 5px 8px; float: right; }
        .list-item { padding: 10px; margin-top: 10px; border-radius: 4px; display: flex; align-items: center; gap: 15px; border: 1px solid var(--border-color); background: #fff; }
        .list-item img { width: 50px; height: 50px; object-fit: cover; border-radius: 50%; border: 2px solid var(--border-color); cursor: pointer; }
        .help-text { font-size: 0.9em; color: #666; margin-top: 5px; }
        #preview-panel { width: 55%; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        #preview-window { flex-grow: 1; background-color: #333; border: 5px solid #222; border-radius: 10px; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; text-align: center; background-size: cover; background-position: center; transition: background-image 0.5s ease; }
        #preview-overlay { background-color: rgba(0, 0, 0, 0.5); padding: 20px; border-radius: 10px; color: white; }
        #preview-title { margin: 0; font-size: 2em; }
        #preview-description { font-size: 1.1em; margin-top: 10px; }
        #preview-character { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); max-height: 40%; width: auto; transition: all 0.3s ease; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5)); }
        #iframe-code { width: calc(100% - 22px); min-height: 100px; background-color: #2d2d2d; color: #9fcc7a; font-family: 'Courier New', Courier, monospace; border: 1px solid var(--border-color); border-radius: 4px; padding: 10px; }
        #generate-btn { width: 100%; padding: 15px; font-size: 1.2em; margin-top: 10px; font-weight: bold; }
        #generate-btn.copied { background-color: var(--success-color); }
        .task-options-container .option-group { display: flex; align-items: center; margin-bottom: 5px; }
        .task-options-container input[type="radio"] { width: auto; margin-right: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –†–µ–¥–∞–∫—Ç–æ—Ä -->
        <aside id="editor-panel">
            <h1>–†–µ–¥–∞–∫—Ç–æ—Ä –ö–≤–µ—Å—Ç–∞</h1>
            <details open>
                <summary>1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∏—Ä–∞</summary>
                <div class="form-group">
                    <label for="quest-title">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞</label>
                    <input type="text" id="quest-title" placeholder="–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –º–∏—Ä –∑–Ω–∞–Ω–∏–π">
                    <label for="quest-description">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="quest-description" placeholder="–ü–æ–º–æ–≥–∏ –≥–µ—Ä–æ—é –ø—Ä–æ–π—Ç–∏ –≤—Å–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è!" style="min-height: 60px;"></textarea>
                </div>
            </details>
            <details><summary>2. –ì–µ—Ä–æ–∏</summary><div id="heroes-list"></div><button class="btn btn-add" onclick="addItem('hero')">–î–æ–±–∞–≤–∏—Ç—å –≥–µ—Ä–æ—è</button></details>
            
            <!-- –ò–ó–ú–ï–ù–ï–ù–û: –†–∞–∑–¥–µ–ª "–í—Ä–∞–≥–∏" —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç textarea -->
            <details>
                <summary>3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã (–∏–∑–±–µ–≥–∞—Ç—å)</summary>
                <div class="form-group">
                    <label for="obs_bad">–°–ø–∏—Å–æ–∫ –≤—Ä–∞–≥–æ–≤ –∏–ª–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π</label>
                    <textarea id="obs_bad" placeholder="ü¶Ö,üß±,üöÅ,‚õàÔ∏è"></textarea>
                    <p class="help-text">–í–≤–æ–¥–∏—Ç–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –∏–ª–∏ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏ –∏–ª–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏.</p>
                </div>
            </details>

            <!-- –ò–ó–ú–ï–ù–ï–ù–û: –†–∞–∑–¥–µ–ª "–ü—Ä–µ–¥–º–µ—Ç—ã" —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç textarea -->
            <details>
                <summary>4. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã (—Å–æ–±–∏—Ä–∞—Ç—å)</summary>
                <div class="form-group">
                    <label for="obs_good">–°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è —Å–±–æ—Ä–∞</label>
                    <textarea id="obs_good" placeholder="üåæ,üåΩ,üçÄ,üçé"></textarea>
                    <p class="help-text">–í–≤–æ–¥–∏—Ç–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –∏–ª–∏ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏.</p>
                </div>
            </details>

            <details><summary>5. –õ–æ–∫–∞—Ü–∏–∏</summary><div id="locations-list"></div><button class="btn btn-add" onclick="addItem('location')">–î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é</button></details>
            <details>
                <summary>6. –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</summary>
                <div class="form-group">
                    <label for="level-easy">–õ–µ–≥–∫–∏–π</label><textarea id="level-easy" placeholder="–ó–∞–¥–∞–Ω–∏—è –ø–æ–ø—Ä–æ—â–µ, –±–æ–ª—å—à–µ –ø–æ–¥—Å–∫–∞–∑–æ–∫." style="min-height: 40px;"></textarea>
                    <label for="level-medium">–°—Ä–µ–¥–Ω–∏–π</label><textarea id="level-medium" placeholder="–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –Ω–∞–±–æ—Ä –∑–∞–¥–∞–Ω–∏–π." style="min-height: 40px;"></textarea>
                    <label for="level-hard">–°–ª–æ–∂–Ω—ã–π</label><textarea id="level-hard" placeholder="–°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è." style="min-height: 40px;"></textarea>
                </div>
            </details>
            <details>
                <summary>7. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ó–∞–¥–∞–Ω–∏–π</summary>
                <div id="tasks-list"></div>
                <button class="btn btn-add" onclick="addTask()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
            </details>
        </aside>

        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è -->
        <main id="preview-panel">
            <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
            <div id="preview-window">
                <div id="preview-overlay">
                    <h2 id="preview-title">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞</h2>
                    <p id="preview-description">–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.</p>
                </div>
                <img id="preview-character" src="" alt="">
            </div>
            <div id="output-section">
                <h2>–ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏</h2>
                <textarea id="iframe-code" readonly placeholder="–ù–∞–∂–º–∏—Ç–µ '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥', —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å iframe..."></textarea>
                <button id="generate-btn" class="btn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            </div>
        </main>
    </div>

    <script>
        const winSoundExample = "data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=";
        const failSoundExample = "data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAA";

        // –ò–ó–ú–ï–ù–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–ø–∏—Å–∫–æ–≤
        function parseList(val){
            return String(val).split(/[\n,]+/).map(s => s.trim()).filter(Boolean);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const previewTitle = document.getElementById('preview-title');
            const previewDescription = document.getElementById('preview-description');
            const previewWindow = document.getElementById('preview-window');
            const previewCharacter = document.getElementById('preview-character');

            document.getElementById('quest-title').addEventListener('input', (e) => { previewTitle.textContent = e.target.value || '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞'; });
            document.getElementById('quest-description').addEventListener('input', (e) => { previewDescription.textContent = e.target.value || '–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.'; });
            
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ì–µ—Ä–æ–µ–≤ –∏ –õ–æ–∫–∞—Ü–∏–π
            window.addItem = (type) => {
                const id = Date.now();
                const container = document.getElementById(`${type}s-list`);
                const itemDiv = document.createElement('div');
                itemDiv.className = 'list-item';
                itemDiv.id = `${type}-${id}`;
                
                let placeholderText = (type === 'hero') ? '–ò–º—è –≥–µ—Ä–æ—è' : '–ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏';
                
                itemDiv.innerHTML = `
                    <img src="https://via.placeholder.com/50" alt="${type}" id="img-${id}" data-base64="" ${type === 'hero' ? `onclick="setPreviewCharacter('${id}')"` : ''}>
                    <div style="flex-grow: 1;">
                        <input type="text" placeholder="${placeholderText}">
                        <textarea placeholder="–û–ø–∏—Å–∞–Ω–∏–µ..." style="min-height: 40px; margin-top: 5px;"></textarea>
                        <input type="file" accept="image/*" style="margin-top: 5px;" onchange="handleImageUpload(this, '${id}')">
                    </div>
                    <button class="btn btn-delete" onclick="this.parentElement.remove()">X</button>
                `;
                container.appendChild(itemDiv);
            };

            window.handleImageUpload = (input, id) => {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const base64 = e.target.result;
                        document.getElementById(`img-${id}`).src = base64;
                        document.getElementById(`img-${id}`).dataset.base64 = base64;
                        updatePreview();
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            };

            window.setPreviewCharacter = (id) => {
                const img = document.getElementById(`img-${id}`);
                if (img && img.dataset.base64) {
                    previewCharacter.src = img.dataset.base64;
                    previewCharacter.style.display = 'block';
                }
            };

            const updatePreview = () => {
                const firstLocation = document.querySelector('#locations-list .list-item img');
                if (firstLocation && firstLocation.dataset.base64) {
                    previewWindow.style.backgroundImage = `url('${firstLocation.dataset.base64}')`;
                } else {
                    previewWindow.style.backgroundImage = 'none';
                }

                const firstHero = document.querySelector('#heroes-list .list-item img');
                 if (!previewCharacter.src && firstHero && firstHero.dataset.base64) {
                    previewCharacter.src = firstHero.dataset.base64;
                    previewCharacter.style.display = 'block';
                } else if (!document.querySelector('#heroes-list .list-item')) {
                    previewCharacter.style.display = 'none';
                }
            };

            window.addTask = () => {
                const id = Date.now();
                const container = document.getElementById('tasks-list');
                const taskDiv = document.createElement('div');
                taskDiv.className = 'task-item';
                taskDiv.id = `task-${id}`;
                taskDiv.innerHTML = `
                    <button class="btn btn-delete" onclick="this.parentElement.remove()">X</button>
                    <div class="form-group"><label>–í–æ–ø—Ä–æ—Å:</label><textarea placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞..."></textarea></div>
                    <div class="form-group">
                        <label>–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è:</label>
                        <select onchange="updateTaskUI(this, '${id}')">
                            <option value="choice">–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞</option><option value="input">–í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞</option>
                        </select>
                    </div>
                    <div id="task-body-${id}"></div>`;
                container.appendChild(taskDiv);
                updateTaskUI(taskDiv.querySelector('select'), id);
            };

            window.updateTaskUI = (select, id) => {
                const body = document.getElementById(`task-body-${id}`);
                const type = select.value;
                if (type === 'choice') {
                    body.innerHTML = `
                        <label>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (–æ—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):</label>
                        <div class="task-options-container">
                            ${[1,2,3,4].map(i => `<div class="option-group"><input type="radio" name="correct-answer-${id}" value="${i-1}"><input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç ${i}"></div>`).join('')}
                        </div>`;
                } else {
                    body.innerHTML = `<label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (—Ç–µ–∫—Å—Ç):</label><input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç">`;
                }
            };
            
            document.getElementById('generate-btn').addEventListener('click', () => {
                const gameData = {
                    title: document.getElementById('quest-title').value,
                    description: document.getElementById('quest-description').value,
                    levels: {
                        easy: document.getElementById('level-easy').value,
                        medium: document.getElementById('level-medium').value,
                        hard: document.getElementById('level-hard').value,
                    },
                    heroes: [], locations: [], tasks: [],
                    // –ò–ó–ú–ï–ù–ï–ù–û: –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
                    enemies: parseList(document.getElementById('obs_bad').value),
                    items: parseList(document.getElementById('obs_good').value),
                };

                document.querySelectorAll('#heroes-list .list-item').forEach(el => {
                    gameData.heroes.push({ name: el.querySelector('input').value, desc: el.querySelector('textarea').value, img: el.querySelector('img').dataset.base64 });
                });
                document.querySelectorAll('#locations-list .list-item').forEach(el => {
                    gameData.locations.push({ name: el.querySelector('input').value, desc: el.querySelector('textarea').value, img: el.querySelector('img').dataset.base64 });
                });
                
                document.querySelectorAll('.task-item').forEach(el => {
                    const task = {
                        question: el.querySelector('textarea').value,
                        type: el.querySelector('select').value,
                    };
                    if (task.type === 'choice') {
                        task.options = Array.from(el.querySelectorAll('.option-group input[type="text"]')).map(opt => opt.value);
                        const correctRadio = el.querySelector('input[type="radio"]:checked');
                        task.correct = correctRadio ? parseInt(correctRadio.value) : 0;
                    } else {
                        task.correct = el.querySelector(`#task-body-${el.id.split('-')[1]} input`).value;
                    }
                    gameData.tasks.push(task);
                });

                const playerHTML = createPlayerHTML(gameData);
                const iframeSrc = `data:text/html;base64,${btoa(unescape(encodeURIComponent(playerHTML)))}`;
                const finalCode = `<iframe src="${iframeSrc}" width="800" height="600" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;

                const iframeCodeTextarea = document.getElementById('iframe-code');
                iframeCodeTextarea.value = finalCode;
                navigator.clipboard.writeText(finalCode).then(() => {
                    const btn = document.getElementById('generate-btn');
                    btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                    btn.classList.add('copied');
                    setTimeout(() => {
                        btn.textContent = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥';
                        btn.classList.remove('copied');
                    }, 2000);
                });
            });

            function createPlayerHTML(data) {
                // –ü–ª–µ–µ—Ä –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç enemies –∏ items, –Ω–æ –æ–Ω–∏ —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –¥–∞–Ω–Ω—ã–µ
                // –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö –∏–≥—Ä—ã.
                return `
<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8">
<style>
body{margin:0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; height:100vh; overflow:hidden; color: #fff; background: #1a1a1a;}
.screen{display:none; width:100%; height:100%; flex-direction:column; justify-content:center; align-items:center; padding:20px; box-sizing:border-box; text-align:center; background-size:cover; background-position:center; position:relative;}
.screen.active{display:flex;}
.screen::before{content:''; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1;}
.content{position:relative; z-index:2;}
h1{font-size:3em;} p{font-size:1.2em;}
.game-btn{background: #4a90e2; color:white; border:none; padding:15px 30px; border-radius:10px; font-size:1.2em; cursor:pointer; transition: transform 0.2s; margin: 10px;}
.game-btn:hover{transform: scale(1.05);}
.card-container{display:flex; gap:20px; flex-wrap:wrap; justify-content:center;}
.hero-card{background:rgba(40,40,40,0.8); border: 1px solid #444; border-radius:15px; padding:20px; width:200px; cursor:pointer; transition: all 0.2s;}
.hero-card:hover{transform: translateY(-10px); border-color: #4a90e2;}
.hero-card img{width:100%; border-radius:10px;}
.game-view{text-align:left;}
#game-character{position:absolute; bottom:10px; left:10px; height:30%; z-index:3;}
#task-modal{display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10; justify-content:center; align-items:center; flex-direction:column;}
#task-modal.active{display:flex;}
.task-content{background:#2a2a2a; padding:30px; border-radius:15px; width:80%; max-width:600px; text-align:center;}
.task-options button {display:block; width:100%; margin:10px 0;}
.task-options input {width: calc(100% - 24px); padding: 12px; margin-top:10px; font-size:1em; border-radius:5px; border:1px solid #555; background:#333; color:#fff;}
</style>
</head><body>
<audio id="win-sound" src="${winSoundExample}"></audio><audio id="fail-sound" src="${failSoundExample}"></audio>
<div id="start-screen" class="screen active"><div class="content"><h1></h1><p></p><button class="game-btn" onclick="game.showScreen('level-screen')">–ù–∞—á–∞—Ç—å!</button></div></div>
<div id="level-screen" class="screen"><div class="content"><h1>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å</h1><div id="level-buttons"></div></div></div>
<div id="hero-screen" class="screen"><div class="content"><h1>–í—ã–±–µ—Ä–∏—Ç–µ –≥–µ—Ä–æ—è</h1><div id="hero-cards" class="card-container"></div></div></div>
<div id="game-screen" class="screen"><img id="game-character" src=""><div class="content game-view"><h1>–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!</h1><p>–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –∫–≤–µ—Å—Ç.</p></div></div>
<div id="task-modal"><div class="task-content"><h2 id="task-question"></h2><div id="task-body"></div></div></div>
<script>
const gameData = JSON.parse(decodeURIComponent(escape(atob('${btoa(unescape(encodeURIComponent(JSON.stringify(data))))}'))));
console.log("Game Data Loaded:", gameData); // –ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏, —á—Ç–æ –≤—Å–µ —Å–ø–∏—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å
const game = {
    state: { level: null, hero: null, currentTask: 0, score: 0 },
    init() {
        document.querySelector('#start-screen h1').textContent = gameData.title;
        document.querySelector('#start-screen p').textContent = gameData.description;
        if (gameData.locations.length > 0) { document.querySelectorAll('.screen').forEach(s => s.style.backgroundImage = \`url(\${gameData.locations[0].img})\`); }
        const levelButtons = document.getElementById('level-buttons'); levelButtons.innerHTML = '';
        Object.keys(gameData.levels).forEach(key => {
            if (gameData.levels[key]) {
                const btn = document.createElement('button'); btn.className = 'game-btn';
                btn.textContent = key.charAt(0).toUpperCase() + key.slice(1); btn.onclick = () => this.selectLevel(key); levelButtons.appendChild(btn);
            }
        });
        const heroCards = document.getElementById('hero-cards'); heroCards.innerHTML = '';
        gameData.heroes.forEach((hero, index) => {
            const card = document.createElement('div'); card.className = 'hero-card';
            card.innerHTML = \`<img src="\${hero.img}" alt="\${hero.name}"><h3>\${hero.name}</h3><p>\${hero.desc}</p>\`;
            card.onclick = () => this.selectHero(index); heroCards.appendChild(card);
        });
    },
    showScreen(screenId) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(screenId).classList.add('active'); },
    selectLevel(level) { this.state.level = level; this.showScreen('hero-screen'); },
    selectHero(heroIndex) { this.state.hero = gameData.heroes[heroIndex]; document.getElementById('game-character').src = this.state.hero.img; this.startGame(); },
    startGame() { this.showScreen('game-screen'); this.state.currentTask = 0; setTimeout(() => this.showNextTask(), 1500); },
    showNextTask() {
        if(this.state.currentTask >= gameData.tasks.length){ alert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø—Ä–æ—à–ª–∏ –∫–≤–µ—Å—Ç! –í–∞—à —Å—á–µ—Ç: ' + this.state.score); this.showScreen('start-screen'); return; }
        const task = gameData.tasks[this.state.currentTask];
        document.getElementById('task-question').textContent = task.question;
        const taskBody = document.getElementById('task-body');
        if(task.type === 'choice') {
            taskBody.innerHTML = '<div class="task-options">' + task.options.map((opt, i) => \`<button class="game-btn" onclick="game.checkAnswer(\${i})">\${opt}</button>\`).join('') + '</div>';
        } else {
            taskBody.innerHTML = '<div class="task-options"><input type="text" id="text-answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."><button class="game-btn" onclick="game.checkAnswer()">–û—Ç–≤–µ—Ç–∏—Ç—å</button></div>';
        }
        document.getElementById('task-modal').classList.add('active');
    },
    checkAnswer(answer) {
        const task = gameData.tasks[this.state.currentTask]; let isCorrect = false;
        if(task.type === 'choice') { if(answer === task.correct) isCorrect = true; } 
        else { const userAnswer = document.getElementById('text-answer').value; if(userAnswer.trim().toLowerCase() === task.correct.trim().toLowerCase()) isCorrect = true; }
        if(isCorrect) { document.getElementById('win-sound').play(); this.state.score += 10; } 
        else { document.getElementById('fail-sound').play(); }
        document.getElementById('task-modal').classList.remove('active'); this.state.currentTask++; setTimeout(() => this.showNextTask(), 1000);
    }
};
game.init();
<\/script></body></html>`;
            }
        });
    </script>
</body>
</html>
